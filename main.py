import discord
from discord.ext import commands, tasks
import os
import random
import aiohttp
import io
from datetime import datetime
from myserver import server_on

# р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ Intents
intents = discord.Intents.default()
intents.members = True  # р╣Ар╕Ыр╕┤р╕Фр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ Server Members Intent

bot = commands.Bot(command_prefix='!', intents=intents)

# р╣Гр╕Кр╣Й environment variable р╕кр╕│р╕лр╕гр╕▒р╕Ъ Token
TOKEN = os.getenv('TOKEN')
chat_channel_id = 1362748298858991778  # р╣Гр╕кр╣И ID р╕Вр╕нр╕Зр╕Кр╣Ир╕нр╕Зр╣Бр╕Кр╕Ч
server_channel_id = 1363123342135132351  # р╣Гр╕кр╣И ID р╕Вр╕нр╕Зр╕Кр╣Ир╕нр╕Зр╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣М

@bot.event
async def on_ready():
    print(f"тЬЕ Logged in as {bot.user}!")
    synced = await bot.tree.sync()
    print(f"{len(synced)} command(s) synced.")
    send_random_messages.start()

@tasks.loop(seconds=20)
async def send_random_messages():
    messages = [
   'р╕бр╕╢р╕Зр╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╣Бр╕ер╣Йр╕зр╣Ар╕лр╕гр╕н? р╕бр╕▓р╕Чр╕│р╣Др╕б ЁЯдиЁЯФе',
    'р╕бр╕▓р╕Фр╕┤р╣Др╕бр╣Ир╕Бр╕ер╕▒р╕зр╣Ар╕ер╕в р╣Ар╕Фр╕╡р╣Лр╕вр╕зр╕Вр╕вр╕╡р╣Йр╣Гр╕лр╣Йр╕Фр╕╣ ЁЯШОЁЯТе',
    'р╕Бр╕╣р╕гр╕нр╕нр╕вр╕╣р╣И, р╕Ир╕░р╕лр╕Щр╕╡р╣Др╕Ыр╣Др╕лр╕Щ ЁЯдб',
    'р╣Др╕лр╕Щ р╕бр╕╢р╕Зр╕Бр╕ер╣Йр╕▓р╕Юр╕╣р╕Фр╣Бр╕Ър╕Ър╕Щр╕╡р╣Йр╕Бр╕▒р╕Ър╕Бр╕╣р╕лр╕гр╕н ЁЯШИЁЯТм',
    'р╕бр╕╢р╕Зр╕Др╕┤р╕Фр╕зр╣Ир╕▓р╕бр╕▓р╕Бр╕╣р╕Ир╕░р╕Бр╕ер╕▒р╕зр╕лр╕гр╕н? р╣Вр╕Чр╕йр╕Чр╕╡ р╕Бр╕╣р╕Вр╕│ ЁЯдг',
    'р╕бр╕╡р╕нр╕░р╣Др╕гр╕Ир╕░р╕Ър╕нр╕Б р╕Бр╕╣р╕Яр╕▒р╕Зр╕нр╕вр╕╣р╣И ЁЯШЬЁЯСМ',
    'р╕бр╕▓р╕Фр╕┤ р╕бр╕▓р╣Ар╕ер╣Ир╕Щр╕Бр╕▒р╕Ър╕Бр╕╣р╕лр╕Щр╣Ир╕нр╕в ЁЯФе',
    'р╣Ар╕нр╣Йр╕▓!! р╕Чр╕│р╣Др╕бр╣Др╕бр╣Ир╕бр╕▓р╕Хр╣Ир╕нр╕кр╕╣р╣Йр╕Ър╣Йр╕▓р╕З ЁЯШд',
    'р╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╕Фр╕┤!! ЁЯШОЁЯФе',
    'р╣Ар╕нр╕▓р╕Фр╕┤ р╣Др╕бр╣Ир╕Бр╕ер╣Йр╕▓р╣Ар╕лр╕гр╕н ЁЯШП',
    'р╕бр╕╡р╣Др╕гр╕Бр╣Зр╕бр╕▓р╕Фр╕┤р╕Др╕гр╕▒р╕Ъ ЁЯТе',
    'р╣Др╕лр╕Щр╣Гр╕Др╕гр╣Бр╕Щр╣И ЁЯШИ',
    'р╣Вр╕нр╣Йр╣Вр╕л р╕Др╕┤р╕Фр╕зр╣Ир╕▓р╕Бр╕ер╕▒р╕зр╕лр╕гр╕н ЁЯдг',
    'р╕бр╕▓р╣Ар╕ер╣Ир╕Щр╕Бр╕▒р╕Щр╕лр╕Щр╣Ир╕нр╕вр╣Др╕лр╕бр╣Ар╕Юр╕╖р╣Ир╕нр╕Щ ЁЯШЬ',
    'р╣Гр╕Ир╕Цр╕╢р╕Зр╕Юр╕╢р╣Ир╕Зр╣Др╕Фр╣Й ЁЯФе',
    'р╕бр╕▓р╕Чр╣Йр╕▓р╣Гр╕лр╣Йр╣Др╕Фр╣Йр╕Бр╕╣р╣Др╕бр╣Ир╕гр╕н ЁЯШд',
    'р╣Ар╕ер╣Ир╕Щр╕Бр╕▒р╕Щр╣Ар╕Цр╕нр╕░ р╕нр╕вр╕▓р╕Бр╣Ар╕лр╣Зр╕Щр╕Др╕Щр╕Чр╕│р╕Хр╕▓р╕б ЁЯШЬ',
    'р╕бр╕╢р╕Зр╕бр╕▓р╕Чр╕│р╣Др╕б ЁЯШП р╕лр╕гр╕╖р╕нр╕Хр╣Йр╕нр╕Зр╣Гр╕лр╣Йр╕Бр╕╣р╕Чр╣Йр╕▓р╕нр╕╡р╕Б? ЁЯФе',
    'р╕бр╕▓р╣Ар╕ер╣Ир╕Щр╕Бр╕▒р╕Щр╣Ар╕Цр╕нр╕░ р╕Ир╕░р╣Др╕Фр╣Йр╕Фр╕╣р╕зр╣Ир╕▓р╕Бр╕╣р╣Ар╕Ир╣Лр╕Зр╕Вр╕Щр╕▓р╕Фр╣Др╕лр╕Щ ЁЯШОЁЯТе',
    'р╕нр╕вр╕▓р╕Бр╕ер╕нр╕Зр╕Вр╕нр╕Зр╕Ир╕гр╕┤р╕Зр╣Ар╕лр╕гр╕н? р╕Бр╕╣р╕гр╕нр╕нр╕вр╕╣р╣И ЁЯШИ',
    'р╕Бр╕ер╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╣Ар╕лр╕гр╕н? р╕Бр╕╣р╣Бр╕Др╣Ир╕гр╕нр╣Ар╕зр╕ер╕▓р╕Ир╕▒р╕Фр╕Бр╕▓р╕г ЁЯШИЁЯТА',
    'р╕бр╕╢р╕Зр╕Ир╕░р╕лр╕Щр╕╡р╣Др╕Ыр╣Др╕лр╕Щ? ЁЯШПЁЯФе р╕нр╕вр╕╣р╣Ир╕Хр╕гр╕Зр╕Щр╕╡р╣Йр╣Бр╕лр╕ер╕░ ЁЯШЬ',
    'р╣Ар╕нр╕▓р╕Фр╕┤ р╣Др╕бр╣Ир╕Бр╕ер╣Йр╕▓р╣Ар╕лр╕гр╕н? ЁЯдб р╕бр╕▓р╕Фр╕╣р╣Гр╕Др╕гр╣Ар╕Ир╣Лр╕Зр╕Бр╕зр╣Ир╕▓ ЁЯШОЁЯТе',
    'р╕бр╕▓р╣Ар╕Цр╕нр╕░ р╕нр╕вр╕▓р╕Бр╣Ар╕лр╣Зр╕Щр╕зр╣Ир╕▓р╕бр╕╢р╕Зр╕Ир╕░р╕Чр╕│р╣Др╕Фр╣Йр╣Др╕лр╕б ЁЯШИЁЯТе',
    'р╣Бр╕Др╣Ир╕Щр╕╡р╣Йр╕бр╕╢р╕Зр╕Бр╣Зр╕Др╕┤р╕Фр╕Ир╕░р╕лр╕вр╕╕р╕Фр╣Бр╕ер╣Йр╕зр╣Ар╕лр╕гр╕н? ЁЯШП р╕Бр╕╣р╕вр╕▒р╕Зр╣Др╕бр╣Ир╣Ар╕лр╕Щр╕╖р╣Ир╕нр╕вр╣Ар╕ер╕в ЁЯФе',
    'р╣Ар╕Вр╣Йр╕▓р╕бр╕▓р╣Ар╕ер╕в р╕Бр╕╣р╕гр╕нр╕нр╕вр╕╣р╣И ЁЯШП р╕нр╕вр╣Ир╕▓р╕Ър╕нр╕Бр╕Щр╕░р╕зр╣Ир╕▓р╕Бр╕ер╕▒р╕з ЁЯШИ',
    'р╕Юр╕╣р╕Фр╣Др╕Ыр╣Ар╕гр╕╖р╣Ир╕нр╕вр╣Ж р╣Бр╕Хр╣Ир╕Чр╕│р╣Др╕бр╣Др╕бр╣Ир╕Бр╕ер╣Йр╕▓р╕бр╕▓р╣Ар╕ер╕в ЁЯШОЁЯФе',
    'р╣Ар╕лр╕вр╕╡р╕вр╕Ър╕бр╕▓р╣Ар╕лр╕нр╕░ р╣Бр╕ер╣Йр╕зр╕Бр╕╣р╕Ир╕░р╣Вр╕Кр╕зр╣Мр╣Гр╕лр╣Йр╕Фр╕╣р╕зр╣Ир╕▓р╣Ар╕Ир╣Лр╕Зр╣Бр╕Др╣Ир╣Др╕лр╕Щ ЁЯШИЁЯТе',
    'р╕бр╕╢р╕Зр╕Др╕┤р╕Фр╕зр╣Ир╕▓р╕Бр╕ер╕▒р╕зр╕лр╕гр╕н? р╕Бр╕╣р╕Вр╕│ ЁЯдгЁЯФе р╕бр╕▓р╣Ар╕ер╕в! ЁЯШЬ',
    'р╕Ир╕░р╣Гр╕лр╣Йр╕Бр╕╣р╣Бр╕кр╕Фр╕Зр╣Гр╕лр╣Йр╕Фр╕╣р╣Др╕лр╕б? р╕Бр╕╣р╕гр╕нр╕нр╕вр╕╣р╣И ЁЯФеЁЯТе',
    'р╣Др╕бр╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕ер╕▒р╕зр╣Др╕Ы р╕Бр╕ер╕▒р╕зр╣Др╕Ыр╕Бр╣Зр╣Др╕бр╣Ир╕Щр╣Ир╕▓р╕кр╕Щр╕╕р╕Б ЁЯШЬЁЯФе',
    'р╕Бр╕╣р╕Ир╕░р╕Ър╕нр╕Бр╣Гр╕лр╣Йр╕бр╕╢р╕Зр╕гр╕╣р╣Йр╣Ар╕нр╕Зр╕зр╣Ир╕▓р╣Гр╕Др╕гр╣Бр╕Щр╣И ЁЯФеЁЯШИ',
    'р╣Др╕бр╣Ир╕гр╕╣р╣Йр╣Ар╕лр╕гр╕нр╕зр╣Ир╕▓р╕бр╕╢р╕Зр╕Чр╕│р╕нр╕░р╣Др╕гр╕бр╕▒р╕Щр╕Бр╣Зр╣Др╕бр╣Ир╕Юр╕нр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕╣ ЁЯШПЁЯТе',
    'р╕бр╕▓р╕бр╕┤ р╕гр╕нр╕Фр╕╣р╕лр╕Щр╣Ир╕нр╕вр╕зр╣Ир╕▓р╕Др╕╕р╕Ур╕Бр╕ер╣Йр╕▓р╣Др╕лр╕б ЁЯШЬЁЯФе',
    'р╕Ир╕░р╕зр╕┤р╣Ир╕Зр╕лр╕Щр╕╡р╣Ар╕лр╕гр╕н? р╕Чр╕│р╣Др╕бр╣Др╕бр╣Ир╕кр╕╣р╣Йр╣Бр╕Ър╕Ър╣Бр╕бр╕Щр╣Ж р╣Др╕Ыр╣Ар╕ер╕в ЁЯШИЁЯТе',
    'р╕лр╕▓р╕вр╣Др╕Ыр╣Др╕лр╕Щ? р╕Бр╕╣р╕гр╕нр╕Др╕│р╕Чр╣Йр╕▓ ЁЯШПЁЯФе',
    'р╣Гр╕Др╕гр╕Бр╕ер╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╕бр╕▓? р╕лр╕гр╕╖р╕нр╕Ир╕░р╣Гр╕лр╣Йр╕Бр╕╣р╣Ар╕Кр╕┤р╕Н ЁЯШЬЁЯФе',
    'р╕бр╕╡р╕нр╕░р╣Др╕гр╕нр╕╡р╕Бр╣Др╕лр╕б? р╕Бр╕╣р╕Юр╕гр╣Йр╕нр╕бр╕Чр╕╕р╕Бр╣Ар╕зр╕ер╕▓ ЁЯШИЁЯТе',
    'р╕Др╕нр╕вр╕Фр╕╣р╣Гр╕лр╣Йр╕Фр╕╡ р╕бр╕╢р╕Зр╕Ир╕░р╣Др╕Фр╣Йр╕гр╕╣р╣Йр╣Ар╕нр╕Зр╕зр╣Ир╕▓р╣Гр╕Др╕гр╣Ар╕Ир╣Лр╕З ЁЯФеЁЯШО'
    ]

    chat_channel = bot.get_channel(chat_channel_id)
    server_channel = bot.get_channel(server_channel_id)

    if chat_channel:
        random_message = random.choice(messages)
        async with aiohttp.ClientSession() as session:
            async with session.get('https://api.imgflip.com/get_memes') as response:
                if response.status == 200:
                    data = await response.json()
                    if 'data' in data and 'memes' in data['data']:
                        meme = random.choice(data['data']['memes'])
                        async with session.get(meme['url']) as img_response:
                            if img_response.status == 200:
                                img_data = await img_response.read()
                                file = discord.File(io.BytesIO(img_data), 'meme.jpg')
                                await chat_channel.send(content=random_message, file=file)

    if server_channel:
        time_now = datetime.utcnow().strftime('%H:%M:%S')
        guild = server_channel.guild
        member_count = guild.member_count
        roles = '\n'.join([role.name for role in guild.roles]) or 'р╣Др╕бр╣Ир╕бр╕╡р╕Ър╕Чр╕Ър╕▓р╕Ч'

        status_message = f"""
**ЁЯХТ р╣Ар╕зр╕ер╕▓р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ:** {time_now}
**ЁЯСе р╕Ир╕│р╕Щр╕зр╕Щр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Я:** {member_count}
**ЁЯУЬ р╕Ър╕Чр╕Ър╕▓р╕Чр╣Гр╕Щр╣Ар╕Лр╕┤р╕гр╣Мр╕Я:**
{roles}
        """
        await server_channel.send(status_message)

server_on()

if TOKEN:
    bot.run(TOKEN)
else:
    print("тЭМ Token not found! Please set the TOKEN environment variable.")
